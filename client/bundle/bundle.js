!function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/client/bundle",e(e.s=43)}([function(t,e,i){var n=i(39);t.exports=n},function(t,e,i){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=i(0);e.getScaleMass=function(t){return 1-Math.sqrt(t)*s.scaleMassFactor},e.getRingRadius=function(t){return s.ringInitSize+Math.sqrt(t)*s.ringFactor},e.getFoodRadius=function(t){return s.foodInitSize+Math.sqrt(t)*s.foodFactor},e.getFoodSpriteRadius=function(t){return s.foodSpriteInitSize+Math.sqrt(t)*s.foodSpriteFactor},e.getBallRadius=function(t){return s.ballInitSize+Math.sqrt(t)*s.ballFactor},e.getBallSpriteRadius=function(t){return s.ballSpriteInitSize+Math.sqrt(t)*s.ballSpriteFactor},e.getBallPos=function(t,e,i,n){return{x:t+i*Math.cos(n),y:e+i*Math.sin(n)}},e.getRingSize=function(t){return s.ringInitSize+Math.sqrt(t)*s.ringFactor},e.getRingMin=function(t){return s.ringMinInitSize+Math.sqrt(t)*s.ringMinFactor},e.getRingMax=function(t){return s.ringMaxInitSize+Math.sqrt(t)*s.ringMaxFactor},e.getRingFreq=function(t){return s.ringFreqInit-Math.sqrt(t)*s.ringFreqFactor},e.getSelfRadius=function(t){return s.selfRadiusInitSize+Math.sqrt(t)*s.selfRadiusFactor},e.getPlayerSpriteRadius=function(t){return s.playerSpriteInitSize+Math.sqrt(t)*s.playerSpriteFactor},e.getScope=function(t,e){return{maxScopeW:t.maxScopeWInit+this.getRingMax(e),maxScopeH:t.maxScopeHInit+this.getRingMax(e),minScopeW:t.minScopeWInit+this.getRingMax(e),minScopeH:t.minScopeHInit+this.getRingMax(e)}},e.getRandomPos=function(t,i,n){var a=void 0;a=Math.random()<s.foodInsideProportion?e.randomIntFromInterval(0,Math.pow(t,2)):e.randomIntFromInterval(Math.pow(i,2),Math.pow(n,2));var r=Math.random()*Math.PI*2;return{x:Math.cos(r)*Math.sqrt(a),y:Math.sin(r)*Math.sqrt(a)}},e.randomIntFromInterval=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},e.inRect=function(t,e,i,n,s,a){return i-s/2<=t&&t<=i+s/2&&n-a/2<=e&&e<=n+a/2},e.distEucl=function(t,e,i,n){return Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2))},e.idxOf=function(t,e,i){for(var n=-1,s=0;s<t.length;s++)if(t[s][e]===i){n=s;break}return n},e.abs=function(t){return t>=0?t:-t},e.round=function(t,e){var i=Math.pow(10,t);return Math.round(e*i)/i},e.sizeObject=function(t){for(var e=[],i=[t],s=0;i.length;){var a=i.pop();"boolean"==typeof a?s+=4:"string"==typeof a?s+=2*a.length:"number"==typeof a?s+=8:"object"===(void 0===a?"undefined":n(a))&&-1===e.indexOf(a)&&e.push(a)}return s},e.getStyle=function(t,e){return{fontFamily:"raleway",fill:"#ffffff",stroke:"#000000",fontSize:Math.floor(t*e)+"px",strokeThickness:2*e}}},function(t,e,i){function n(t){this.id=t,this.state={},this.updates=[],this.visible=!1,setTimeout(function(){this.visible=!0}.bind(this),a.clientInterpolationTime),this.toRemove=!1}var s=i(4),a=i(0);t.exports=n,n.prototype={addUpdate:function(t,e){var i=new s(t,e);0===this.updates.length&&(this.state=i.state),this.updates.push(i),this.updates.length>a.clientMaxUpdateBuffer&&this.updates.splice(0,1)},setState:function(t){this.state=t},setToRemove:function(t){this.toRemove=t},getUpdates:function(){return this.updates},getInterpolatedUpdates:function(t){for(var e={},i=0;i<this.updates.length-1;i++){var n=this.updates[i],s=this.updates[i+1];if(t>=n.time&&t<s.time){e.previous=n,e.target=s;break}}return e},getId:function(){return this.id},isVisible:function(){return this.visible},isToRemove:function(){return this.toRemove}}},function(t,e,i){function n(){this.entities=[],this.removedEntities=[]}var s=i(1),a=i(0);t.exports=n,n.prototype={removeEntity:function(t){var e=this.entities.indexOf(t);this.remove(e)},remove:function(t){t>=0&&(this.removedEntities.push(this.entities[t]),this.entities.splice(t,1))},clearEntities:function(){for(var t=this.entities.length;t--;)this.removedEntities.push(this.entities[t]),this.entities.splice(t,1)},clearRemovedEntities:function(){this.removedEntities=[]},getEntities:function(){return this.entities},getRemovedEntities:function(){return this.removedEntities},getEntityState:function(t){var e=!1;-1===t&&(e=a.spectatorInitState);var i=s.idxOf(this.entities,"id",t);return i>=0&&(e=this.entities[i].state),e}}},function(t,e){function i(t,e){this.state=t,this.time=e}t.exports=i},function(t,e,i){var n=i(1),s=i(0);e.getInitPlayerState=function(){return{x:0,y:0,vx:0,vy:0,ring:!1,mass:s.playerInitMass,dashing:!1,startTime:new Date,lastRing:new Date,lastDash:new Date,canDash:!1,immunity:!0}},e.getInitSpectatorState=function(){return{x:0,y:0,mass:0}},e.getInitFoodState=function(){var t=n.getRandomPos(s.midLimitRad-50,s.midLimitRad+s.midLimitStroke+50,s.endLimitRad-50);return{x:t.x,y:t.y}},e.getInitBallState=function(t,e,i){var s=n.getRingRadius(t.mass),a=n.getBallPos(t.x,t.y,s,i);return{x:a.x,y:a.y,mass:e,angle:i,active:!0}}},function(t,e,i){"use strict";function n(){this.gameloop=new r,this.cv=new s.a,this.keyboard=new o,this.mouse=new l(this.cv.canvas);var t=location.origin.replace(/^http/,"ws"),e=new WebSocket(t);e.binaryType="arraybuffer",e.onopen=function(t){this.client=new a(e),this.startGame()}.bind(this)}Object.defineProperty(e,"__esModule",{value:!0});var s=i(13),a=i(16),r=i(34),o=i(35),l=i(36),h=i(0);n.prototype={startGame:function(){var t=this,e=this.client.getSelfId(),i=0,n=null,s=0;this.gameloop.start(function(){var i=t.client.getStateController(),a=new Date;n=n||a,s=a-n,n=a,i.updatePlayerStates(),i.predictShootStates(s),i.predictFoodStates(s),t.client.isInTransition()&&(-1===e?e=t.updateNewGame():(console.log("ooooh"),e=t.updateGameOver())),-1!==e&&t.processInputs()},function(){if(t.cv.assetsLoaded){-1!==e&&t.cv.cam.smoothResize(s);var n=t.client.getStateController(),a=n.getPlayerController(),r=n.getFoodController(),o=n.getShootController();t.removeRemovedEntitiesSprites(a,r,o);var l=a.getEntities(),h=r.getEntities(),c=o.getEntities(),d=a.getEntityState(e);if(void 0!==d.mass){d.mass!==i&&(i=d.mass,t.cv.cam.resizeMass(i)),t.cv.vmap.drawMap(d);for(var u=h.length;u--;){var p=h[u];p.isVisible()&&t.cv.vfood.drawFood(p,d)}for(var f=c.length;f--;){var v=c[f];v.isVisible()&&t.cv.vshoot.drawShoot(v,d)}for(var g=l.length;g--;){var m=l[g];if(m.isVisible()){t.cv.vplayer.drawPlayer(m,d);for(var y=m.getBallController().getEntities(),x=y.length;x--;){var b=y[x];t.cv.vball.drawBall(b,d)}}}t.cv.hud.drawHud(d),a.isUpdatedBoard()&&(t.cv.hud.drawBoard(a.getBoard()),a.setUpdatedBoard(!1)),t.cv.render()}t.cv.hud.fps.setFps(new Date)}})},processInputs:function(){this.processKeyboard(),this.processMouse()},processKeyboard:function(){var t=this.keyboard.pressed("leftEU"),e=this.keyboard.pressed("leftUS"),i=t||e,n=this.keyboard.pressed("right"),s=this.keyboard.pressed("space");i&&this.keyboard.keyUp.left&&(this.client.onInput(10),this.keyboard.keyUp.left=!1),n&&this.keyboard.keyUp.right&&(this.client.onInput(11),this.keyboard.keyUp.right=!1),s&&this.keyboard.keyUp.space&&(this.client.onInput(12),this.keyboard.keyUp.space=!1),i||(this.keyboard.keyUp.left=!0),n||(this.keyboard.keyUp.right=!0),s||(this.keyboard.keyUp.space=!0),h.debugMove&&(this.keyboard.keyUp.left=!0,this.keyboard.keyUp.right=!0)},processMouse:function(){this.mouse.click&&(this.client.onInput(13),this.mouse.click=!1);var t=this.mouse.wheeled();t>0?this.cv.cam.zoomIn(t):t<0&&this.cv.cam.zoomOut(-t)},updateNewGame:function(){var t=document.getElementById("signPanelDiv"),e=document.getElementById("hudDiv");return t.style.display="none",e.style.visibility="visible",this.cv.hud.container.visible=!0,this.mouse.running=!0,this.client.setInTransition(!1),this.client.getSelfId()},updateGameOver:function(){var t=document.getElementById("signPanelDiv"),e=document.getElementById("hudDiv");return t.style.display="block",e.style.visibility="hidden",this.cv.hud.container.visible=!1,this.mouse.running=!1,this.client.setInTransition(!1),-1},removeRemovedEntitiesSprites:function(t,e,i){this.cv.removeSprites(t.getRemovedEntities(),e.getRemovedEntities(),i.getRemovedEntities()),t.clearRemovedEntities(),i.clearRemovedEntities(),e.clearRemovedEntities()}},document.getElementById("sign-form").onsubmit=function(t){return t.preventDefault(),!1};new n},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),r=i(0),o=function(){function t(e){n(this,t),this.cv=e,this.canvas=e.canvas}return s(t,[{key:"drawBall",value:function(t,e){t.sprite||(t.sprite=new PIXI.extras.MovieClip(this.cv.txt.fireballTxtList),t.sprite.animationSpeed=.2,t.sprite.play(),t.sprite.anchor.set(.5),t.sprite.alpha=0,t.sprite.displayGroup=this.cv.playerLayer,this.cv.stage.addChild(t.sprite));var i=a.getBallSpriteRadius(t.state.mass),n=t.state.x-e.x+this.canvas.width/2,s=t.state.y-e.y+this.canvas.height/2;t.sprite.position.set(n,s),t.sprite.rotation=t.state.angle+Math.PI/2;var o=1;if(t.sprite.alpha<1&&(t.sprite.alpha+=.05,t.sprite.alpha=Math.round(100*t.sprite.alpha)/100,o=t.sprite.alpha),t.sprite.width=i*o,t.sprite.height=i*o,r.debugBall){var l=a.getBallRadius(t.state.mass);this.cv.debug.lineStyle(2,16711680),this.cv.debug.drawCircle(n,s,l)}}}]),t}();e.a=o},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),r=i(0),o=function(){function t(e){n(this,t),this.cv=e,this.canvas=e.canvas}return s(t,[{key:"drawFood",value:function(t,e){if(!t.sprite){t.sprite=new PIXI.Sprite(this.cv.txt.foodTxt),t.sprite.blendMode=PIXI.BLEND_MODES.ADD;var i=a.randomIntFromInterval(0,r.gradColors.length-1);t.sprite.tint=r.gradColors[i],t.sprite.anchor.set(.5),t.sprite.alpha=0,t.sprite.displayGroup=this.cv.foodLayer,this.cv.stage.addChild(t.sprite)}var n=t.state.x-e.x+this.canvas.width/2,s=t.state.y-e.y+this.canvas.height/2;t.sprite.position.x=n,t.sprite.position.y=s;var o=a.getFoodSpriteRadius(t.mass),l=1;if(t.sprite.alpha<1&&(t.sprite.alpha+=.05,t.sprite.alpha=Math.round(100*t.sprite.alpha)/100,l=t.sprite.alpha),t.referrer){var h=t.referrer.state,c=a.distEucl(h.x,h.y,t.state.x,t.state.y);l=1-(r.foodHitbox-r.foodEatenHitbox)/(2*c),l<0&&(l=0)}if(o*=l,t.sprite.width=o,t.sprite.height=o,r.debugFoodHitbox){var d=a.getFoodRadius(t.mass);this.cv.debug.lineStyle(1,16711680),this.cv.debug.drawCircle(t.state.xReal-e.x+this.canvas.width/2,t.state.yReal-e.y+this.canvas.height/2,d)}}}]),t}();e.a=o},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(0),r=function(){function t(e){n(this,t),this.cv=e,this.canvas=e.canvas}return s(t,[{key:"preloadSprites",value:function(){this.map=new PIXI.extras.TilingSprite(this.cv.txt.mapTxt,a.mapSize,a.mapSize),this.map.displayGroup=this.cv.mapLayer,this.cv.stage.addChild(this.map),this.bg=new PIXI.extras.TilingSprite(this.cv.txt.bgTxt,a.mapSize,a.mapSize),this.bg.displayGroup=this.cv.limitLayer,this.cv.stage.addChild(this.bg),this.midLimit=new PIXI.Sprite(this.cv.txt.midLimitTxt),this.midLimit.displayGroup=this.cv.limitLayer,this.cv.stage.addChild(this.midLimit),this.endLimit=new PIXI.Sprite(this.cv.txt.endLimitTxt),this.endLimit.displayGroup=this.cv.limitLayer,this.cv.stage.addChild(this.endLimit),this.tunnel=new PIXI.Graphics,this.tunnel.displayGroup=this.cv.tunnelLayer,this.cv.stage.addChild(this.tunnel),this.cv.debug=new PIXI.Graphics,this.cv.debug.displayGroup=this.cv.tunnelLayer,this.cv.stage.addChild(this.cv.debug)}},{key:"drawMap",value:function(t){var e=this.canvas.width/2-t.x,i=this.canvas.height/2-t.y;this.map.anchor.set(.5),this.map.position.set(e,i),this.map.scale.set(a.mapScale),this.map.alpha=1,this.map.tint=28359,this.bg.anchor.set(.5),this.bg.position.set(e,i),this.bg.scale.set(0),this.bg.visible=!1;var n=Math.atan2(t.y,t.x);if(this.midLimit.position.x=e+a.midLimitOffset*Math.sqrt(2)*Math.cos(n),this.midLimit.position.y=i+a.midLimitOffset*Math.sqrt(2)*Math.sin(n),this.midLimit.rotation=-Math.PI/4+n,this.endLimit.position.x=e+a.endLimitOffset*Math.sqrt(2)*Math.cos(n),this.endLimit.position.y=i+a.endLimitOffset*Math.sqrt(2)*Math.sin(n),this.endLimit.rotation=-Math.PI/4+n,this.tunnel.clear(),this.tunnel.beginFill(65280,.5),t.x<0?this.tunnel.drawRect(e-(a.midLimitRad+a.midLimitStroke),i-a.tunnelHeight/2,a.midLimitStroke,a.tunnelHeight):this.tunnel.drawRect(e+a.midLimitRad,i-a.tunnelHeight/2,a.midLimitStroke,a.tunnelHeight),this.cv.debug.clear(),a.debugTileSize){this.cv.debug.lineStyle(3,16711680);var s=Math.floor(a.endLimitRad/a.tileAmountX),r=Math.floor(a.endLimitRad/a.tileAmountY);this.cv.debug.drawRect(e,i,s,r)}}}]),t}();e.a=r},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(0),r=i(1),o=function(){function t(e){n(this,t),this.cv=e,this.canvas=e.canvas}return s(t,[{key:"drawPlayer",value:function(t,e){t.sprite||(t.sprite=new PIXI.extras.MovieClip(this.cv.txt.playerTxtList),t.sprite.animationSpeed=.15,t.sprite.play(),t.sprite.anchor.set(.5),t.sprite.displayGroup=this.cv.playerLayer,this.cv.stage.addChild(t.sprite),t.spriteDash=new PIXI.extras.MovieClip(this.cv.txt.dashTxtList),t.spriteDash.animationSpeed=.3,t.spriteDash.anchor.set(.5),t.spriteDash.blendMode=PIXI.BLEND_MODES.ADD,t.spriteDash.visible=!1,t.spriteDash.displayGroup=this.foodLayer,this.cv.stage.addChild(t.spriteDash),t.spriteRing=new PIXI.Sprite(this.cv.txt.ringTxt),t.spriteRing.anchor.set(.5),t.spriteRing.alpha=0,t.spriteRing.displayGroup=this.cv.playerLayer,this.cv.stage.addChild(t.spriteRing),t.graphics=new PIXI.Graphics,this.cv.stage.addChild(t.graphics),t.text=new PIXI.Text(t.name,a.textOpt),t.text.anchor.set(.5),this.cv.hud.container.addChild(t.text));var i=r.getPlayerSpriteRadius(t.state.mass),n=t.state.x-e.x+this.canvas.width/2,s=t.state.y-e.y+this.canvas.height/2;t.text.position.x=n,t.text.position.y=s+i-15,t.text.style=r.getStyle(14,this.cv.cam.scale);var o=Math.atan2(t.state.vy,t.state.vx);if(t.state.vx<0?(t.sprite.scale.x=-1,t.sprite.rotation=o+Math.PI):(t.sprite.scale.x=1,t.sprite.rotation=o),t.state.dashing||0!==t.sprite.currentFrame||t.state.vy!==a.playerVy?t.sprite.playing||t.sprite.play():t.sprite.stop(),t.state.dashing?(t.sprite.animationSpeed=.3,t.sprite.alpha>.8&&(t.sprite.alpha-=.05),t.spriteDash.play(),t.spriteDash.visible=!0):t.spriteDash.playing&&(t.sprite.animationSpeed=.15,t.sprite.alpha=1,t.spriteDash.gotoAndStop(0),t.spriteDash.visible=!1),t.sprite.position.x=n-3,t.sprite.position.y=s+8,t.sprite.width=i,t.sprite.height=i*(t.sprite._texture.baseTexture.height/t.sprite._texture.baseTexture.width),t.spriteDash.position.x=n,t.spriteDash.position.y=s,t.spriteDash.width=i,t.spriteDash.height=i,i=r.getRingSize(t.state.mass),t.spriteRing.position.x=n,t.spriteRing.position.y=s,t.spriteRing.width=i,t.spriteRing.height=i,t.state.ring?t.spriteRing.alpha<1&&(t.spriteRing.alpha+=.1,t.spriteRing.alpha=Math.round(10*t.spriteRing.alpha)/10):t.spriteRing.alpha>0&&(t.spriteRing.alpha=0),t.spriteRing.visible=!1,this.cv.debug.lineStyle(2,16711680),a.debugSelfHitbox){var l=r.getSelfRadius(t.state.mass);this.cv.debug.drawCircle(n,s,l)}if(a.debugSelfScope){var h=Math.floor(a.tileScopeAmountX*a.endLimitRad/a.tileAmountX),c=Math.floor(a.tileScopeAmountY*a.endLimitRad/a.tileAmountY);this.cv.debug.drawRect(n-h/4,s-c/4,h/2,c/2)}a.debugRingHitbox&&(this.cv.debug.drawCircle(n,s,r.getRingMin(t.state.mass)),this.cv.debug.drawCircle(n,s,r.getRingMax(t.state.mass)))}}]),t}();e.a=o},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),r=i(0),o=function(){function t(e){n(this,t),this.cv=e,this.canvas=e.canvas}return s(t,[{key:"drawShoot",value:function(t,e){t.sprite||(t.sprite=new PIXI.Sprite(this.cv.txt.ringTxt),t.sprite.anchor.set(.5),t.sprite.displayGroup=this.cv.playerLayer,this.cv.stage.addChild(t.sprite));var i=a.getRingSize(t.state.mass),n=t.state.lifeTime/r.dashTime;n>1&&(n=1),t.sprite.width=n*i,t.sprite.height=n*i,t.sprite.position.x=t.state.x-e.x+this.canvas.width/2,t.sprite.position.y=t.state.y-e.y+this.canvas.height/2}}]),t}();e.a=o},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(0),r=i(1),o=function(){function t(e){n(this,t),this.cv=e,this.scale=1,this.scaleMass=1,this.zoom=0,this.scaleTarget=1,this.scaleCurrent=1}return s(t,[{key:"setScaleTarget",value:function(t){this.scaleTarget=this.scale*this.scaleMass*Math.pow(a.zoomFactor,this.zoom),t||(this.scaleCurrent=this.scaleTarget,this.resizeStage(this.scaleCurrent))}},{key:"smoothResize",value:function(t){this.scaleTarget>this.scaleCurrent?(this.scaleCurrent+=.003*t,this.scaleCurrent>this.scaleTarget&&(this.scaleCurrent=this.scaleTarget),this.resizeStage(this.scaleCurrent)):this.scaleTarget<this.scaleCurrent&&(this.scaleCurrent-=.003*t,this.scaleCurrent<this.scaleTarget&&(this.scaleCurrent=this.scaleTarget),this.resizeStage(this.scaleCurrent))}},{key:"zoomIn",value:function(t){for(var e=0;e<t;e++){if(this.scale*this.scaleMass*Math.pow(a.zoomFactor,this.zoom+1)>a.zoomScaleLimit)break;this.zoom+=1}this.setScaleTarget(!0)}},{key:"zoomOut",value:function(t){for(var e=0;e<t;e++)this.zoom-=1,this.zoom<0&&!a.debugZoom&&(this.zoom=0);this.setScaleTarget(!0)}},{key:"resizeCamera",value:function(){this.resizeCanvas(),this.resizeHud()}},{key:"resizeCanvas",value:function(){console.log("res");var t=1.25*window.innerWidth,e=1.25*window.innerHeight;this.cv.canvas.width=t,this.cv.canvas.height=e,this.cv.renderer.resize(this.cv.canvas.width,this.cv.canvas.height),this.cv.stage.pivot.x=this.cv.canvas.width/2,this.cv.stage.pivot.y=this.cv.canvas.height/2,this.cv.stage.position.x=this.cv.canvas.width/2,this.cv.stage.position.y=this.cv.canvas.height/2;var i=Math.max(t/a.scopeInitX,e/a.scopeInitY),n=r.round(2,i*a.scopeInitX),s=r.round(2,i*a.scopeInitY);n>t?this.scale=window.innerHeight/a.scopeInitY:s>e&&(this.scale=window.innerWidth/a.scopeInitX),this.setScaleTarget(!1)}},{key:"resizeMass",value:function(t){this.scaleMass=r.getScaleMass(t),this.setScaleTarget(!1)}},{key:"resizeStage",value:function(t){this.cv.stage.scale.set(t)}},{key:"resizeHud",value:function(){var t=document.getElementById("leaderboard"),e=document.getElementById("boardDiv"),i=document.getElementById("entry");t.style.fontSize=e.offsetWidth/7+"px",i.style.fontSize=e.offsetWidth/11+"px";var n=5*this.scale,s=5*this.scale,o=5*this.scale,l=this.cv.canvas.height-25*this.scale,h=5*this.scale,c=30*this.scale,d=5*this.scale,u=50*this.scale,p=this.cv.canvas.width-60*this.scale,f=this.cv.canvas.height-60*this.scale;this.cv.hud.fpsText.position.set(n,s),this.cv.hud.score.position.set(o,l),this.cv.hud.x.position.set(h,c),this.cv.hud.y.position.set(d,u),console.log(this.scale);var v=r.getStyle(20,this.scale);console.log(v),this.cv.hud.fpsText.style=v,this.cv.hud.score.style=v,this.cv.hud.x.style=v,this.cv.hud.y.style=v,this.cv.hud.minimap.clear(),this.cv.hud.minimap.beginFill(11053224,.5),this.cv.hud.minimap.drawCircle(p,f,a.minimapRad*this.scale)}}]),t}();e.a=o},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=i(12),a=i(14),r=i(15),o=i(9),l=i(10),h=i(7),c=i(8),d=i(11),u=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),p=i(0),f=function(){function t(){var e=this;n(this,t),this.canvas=document.getElementById("ctx"),this.assetsLoaded=!1,this.txt=new r.a(this),this.hud=new a.a(this),this.cam=new s.a(this),this.vmap=new o.a(this),this.vplayer=new l.a(this),this.vball=new h.a(this),this.vfood=new c.a(this),this.vshoot=new d.a(this),this.preload(),window.addEventListener("resize",function(t){e.cam.resizeCamera()}),this.cam.resizeCamera()}return u(t,[{key:"preload",value:function(){this.renderer=new PIXI.autoDetectRenderer(p.scopeInitX,p.scopeInitY,{view:this.canvas}),this.renderer.clearBeforeRender=!1,this.preloadStage(),this.txt.preloadTextures(),this.hud.preloadHud()}},{key:"preloadStage",value:function(){this.stage=new PIXI.Container,this.stage.displayList=new PIXI.DisplayList,this.mapLayer=new PIXI.DisplayGroup(1,!1),this.limitLayer=new PIXI.DisplayGroup(2,!1),this.tunnelLayer=new PIXI.DisplayGroup(3,!1),this.foodLayer=new PIXI.DisplayGroup(4,!1),this.playerLayer=new PIXI.DisplayGroup(5,!1)}},{key:"onTexturesLoaded",value:function(){this.vmap.preloadSprites(),this.vmap.drawMap({x:0,y:0}),this.assetsLoaded=!0,document.getElementById("signPanelDiv").style.display="block",this.canvas.style.display="block"}},{key:"render",value:function(){this.renderer.render(this.stage),this.renderer.render(this.hud.container)}},{key:"removeSprites",value:function(t,e,i){for(var n=t.length;n--;){var s=t[n].getBallController().getEntities();t[n].sprite&&(this.stage.removeChild(t[n].sprite),t[n].sprite.destroy());for(var a=s.length;a--;)s[a].sprite&&(this.stage.removeChild(s[a].sprite),s[a].sprite.destroy());t[n].spriteRing&&(this.stage.removeChild(t[n].spriteRing),t[n].spriteRing.destroy()),t[n].spriteDash&&(this.stage.removeChild(t[n].spriteDash),t[n].spriteDash.destroy()),t[n].graphics&&(this.stage.removeChild(t[n].graphics),t[n].graphics.destroy(!0)),t[n].text&&(this.hud.container.removeChild(t[n].text),t[n].text.destroy(!0))}for(var r=e.length;r--;)e[r].sprite&&(this.stage.removeChild(e[r].sprite),e[r].sprite.destroy());for(var o=i.length;o--;)i[o].sprite&&(this.stage.removeChild(i[o].sprite),i[o].sprite.destroy())}}]),t}();e.a=f},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(42),r=i(0),o=function(){function t(e){n(this,t),this.cv=e,this.canvas=e.canvas}return s(t,[{key:"preloadHud",value:function(){var t=this;this.container=new PIXI.Container;var e=["one","two","three","four","five","six","seven","eight","nine","ten"];this.entries=[];for(var i=0;i<10;i++)this.entries.push(document.getElementById(e[i]));this.fps=new a,this.fpsText=new PIXI.Text("",r.textOpt),this.container.addChild(this.fpsText),setInterval(function(){t.fpsText.text="Fps: "+t.fps.getFps()},1e3),this.score=new PIXI.Text("",r.textOpt),this.container.addChild(this.score),this.x=new PIXI.Text("",r.textOpt),this.container.addChild(this.x),this.y=new PIXI.Text("",r.textOpt),this.container.addChild(this.y),this.minimap=new PIXI.Graphics,this.container.addChild(this.minimap),this.miniself=new PIXI.Graphics,this.container.addChild(this.miniself),this.container.visible=!1}},{key:"drawBoard",value:function(t){for(var e=t.length,i=0;i<e;i++)this.entries[i].textContent=i+1+". "+t[i];if(e<10)for(var n=e;n<10;n++)this.entries[n].textContent=""}},{key:"drawHud",value:function(t){this.score.text!=="Mass : "+t.mass&&(this.score.text="Mass : "+t.mass),this.x.text="x: "+Math.round(t.x),this.y.text="y: "+Math.round(t.y);var e=this.canvas.width+(t.x*r.minimapRad/r.midLimitRad-60)*this.cv.cam.scale,i=this.canvas.height+(t.y*r.minimapRad/r.midLimitRad-60)*this.cv.cam.scale;this.miniself.clear(),this.miniself.beginFill(0,.5),this.miniself.drawCircle(e,i,r.miniselfRad*this.cv.cam.scale)}}]),t}();e.a=o},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(0),r=function(){function t(e){n(this,t),this.cv=e}return s(t,[{key:"preloadTextures",value:function(){this.loader=new PIXI.loaders.Loader,this.loader.add("ringTxt",a.ringImg).add("mapTxt",a.mapImg).add("bgTxt",a.bgImg).add("foodTxt",a.foodImg).add(a.playerSet).add(a.fireballSet).on("progress",this.onAssetsLoading.bind(this)).once("complete",this.onAssetsLoaded.bind(this)).load();var t=this.createBorderTexture(a.midLimitRad,a.midLimitStroke,a.midLimitOffset);this.midLimitTxt=new PIXI.Texture.fromCanvas(t);var e=this.createBorderTexture(a.endLimitRad,a.endLimitStroke,a.endLimitOffset);this.endLimitTxt=new PIXI.Texture.fromCanvas(e),this.dashTxtList=[];for(var i=0;i<a.dashTxtSize;i++){var n={x:25,y:25,rad:25,r:252,g:233,b:102},s=this.createDashTexture(i,n);this.dashTxtList.push(new PIXI.Texture.fromCanvas(s))}var r=this.dashTxtList.slice(1,-1);this.dashTxtList=this.dashTxtList.concat(r.reverse())}},{key:"onAssetsLoading",value:function(t,e){console.log("Progress:",t.progress+"%")}},{key:"onAssetsLoaded",value:function(){var t=this.loader.resources;this.ringTxt=t.ringTxt.texture,this.mapTxt=t.mapTxt.texture,this.bgTxt=t.bgTxt.texture,this.foodTxt=t.foodTxt.texture,this.playerTxtList=[];for(var e=1;e<5;e++)this.playerTxtList.push(PIXI.Texture.fromFrame("frame-"+e+".png"));this.fireballTxtList=[];for(var i=0;i<6;i++)this.fireballTxtList.push(PIXI.Texture.fromFrame("fireball"+i+".png"));this.cv.onTexturesLoaded()}},{key:"createBorderTexture",value:function(t,e,i){var n=t+e-i,s=this.createCanvas(n,n),r=s.getContext("2d");return a.debugBorder&&(r.strokeStyle="rgba(250, 255, 0, 0.7)",r.lineWidth=5,r.strokeRect(0,0,n,n)),r.beginPath(),r.arc(-i,-i,t+e/2,0,Math.PI/2),r.lineWidth=e,r.strokeStyle="rgba(255, 0, 0, 0.7)",r.stroke(),s}},{key:"createFoodTexture",value:function(t){var e=a.foodInitSize+t*a.foodFactor,i=this.createCanvas(e,e),n=i.getContext("2d");n.globalCompositeOperation="lighter",a.debugFood&&(n.strokeStyle="rgba(250, 255, 0, 0.7)",n.lineWidth=5,n.strokeRect(0,0,e,e)),n.beginPath();var s={x:e/2,y:e/2,rad:e/2},r=n.createRadialGradient(s.x,s.y,0,s.x,s.y,s.rad),o="rgba(255, 255, 255, 0.4)";r.addColorStop(0,o),r.addColorStop(.6,o),n.fillStyle=r,n.arc(s.x,s.y,s.rad,0,2*Math.PI,!1),n.fill(),r=n.createRadialGradient(s.x,s.y,0,s.x,s.y,s.rad),o="rgba(255, 255, 255, 0.4)";var l="rgba(255, 255, 255, 0.0)";return r.addColorStop(0,l),r.addColorStop(.6,l),r.addColorStop(.6,o),r.addColorStop(1,l),n.fillStyle=r,n.arc(s.x,s.y,s.rad,0,2*Math.PI,!1),n.fill(),n.fill(),i}},{key:"createDashTexture",value:function(t,e){var i=this.createCanvas(2*e.rad,2*e.rad),n=i.getContext("2d");n.globalCompositeOperation="lighter",n.beginPath();var s=n.createRadialGradient(e.x,e.y,0,e.x,e.y,e.rad),a="rgba("+e.r+","+e.g+","+e.b+",0.6)",r="rgba("+e.r+","+e.g+","+e.b+",0.0)";s.addColorStop(0,a),s.addColorStop(.7+.05*t,r),n.fillStyle=s,n.arc(e.x,e.y,e.rad,0,2*Math.PI,!1);for(var o=-3;o<t;o++)n.fill();return i}},{key:"createCanvas",value:function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i}}]),t}();e.a=r},function(t,e,i){function n(t){a.debug&&new s(t),this.socket=t,this.stateController=new l,this.selfId=-1,this.inTransition=!1,o.call(this),r.call(this)}var s=(i(27),i(26)),a=i(0),r=i(33),o=i(32),l=i(25);t.exports=n,n.prototype=_.extend(Object.create(r.prototype),Object.create(o.prototype),{onDisconnect:function(){this.stateController.clearEntities(),this.socket.close(),console.log("Disconnected")},setInTransition:function(t){this.inTransition=t},getStateController:function(){return this.stateController},getSelfId:function(){return this.selfId},isInTransition:function(){return this.inTransition}})},function(t,e,i){function n(t,e,i){s.call(this),this.nextId=1,this.referrerId=t,this.ballAngle=e,this.ballLastTime=i}var s=i(3),a=i(18);t.exports=n,n.prototype=_.extend(Object.create(s.prototype),{add:function(t){var e=new a(this.nextId++,this.referrerId,t);return this.entities.push(e),e},getBallAngle:function(){return this.ballAngle},getBallLastTime:function(){return this.ballLastTime},setBallAngle:function(t){this.ballAngle=t},setBallLastTime:function(t){this.ballLastTime=t}})},function(t,e,i){function n(t,e,i){s.call(this,t),this.referrerId=e,this.state=a.getInitBallState(i,0,0)}var s=i(2),a=i(5);t.exports=n,n.prototype=_.extend(Object.create(s.prototype),{})},function(t,e,i){function n(t,e){s.call(this,t),this.state.movingTime=0,this.mass=e}var s=i(2);t.exports=n,n.prototype=Object.create(s.prototype)},function(t,e,i){function n(t,e,i,n){s.call(this,t),this.name=e,this.ballController=new a(t,i,n)}var s=i(2),a=i(17),r=i(4),o=i(0);t.exports=n,n.prototype=_.extend(Object.create(s.prototype),{addUpdate:function(t,e){var i=t;if(0===this.updates.length)this.state=t;else{var n=this.updates[this.updates.length-1].state;void 0===t.x&&(i.x=n.x),void 0===t.y&&(i.y=n.y),void 0===t.vx&&(i.vx=n.vx),void 0===t.vy&&(i.vy=n.vy),void 0===t.ring&&(i.ring=n.ring),void 0===t.mass&&(i.mass=n.mass),void 0===t.dashing&&(i.dashing=n.dashing)}var s=new r(i,e);this.updates.push(s),this.updates.length>o.clientMaxUpdateBuffer&&this.updates.splice(0,1)},getBallController:function(){return this.ballController}})},function(t,e,i){function n(t){s.call(this,t)}var s=i(2);t.exports=n,n.prototype=Object.create(s.prototype)},function(t,e,i){function n(){s.call(this)}var s=i(3),a=i(19);t.exports=n,n.prototype=_.extend(s.prototype,{add:function(t,e){var i=new a(t,e);return this.entities.push(i),i}})},function(t,e,i){function n(){s.call(this),this.board=[],this.updatedBoard=!1}var s=i(3),a=i(20);t.exports=n,n.prototype=_.extend(Object.create(s.prototype),{add:function(t,e,i,n){var s=new a(t,e,i,n);return this.entities.push(s),s},setBoard:function(t){this.board=t},setUpdatedBoard:function(t){this.updatedBoard=t},getBoard:function(){return this.board},isUpdatedBoard:function(){return this.updatedBoard}})},function(t,e,i){function n(){s.call(this)}var s=i(3),a=i(21);t.exports=n,n.prototype=Object.create(s.prototype),n.prototype.add=function(t){var e=new a(t);return this.entities.push(e),e}},function(t,e,i){function n(){this.serverTime=0,this.interpolationTime=s.clientInterpolationTime,this.rendered=0,this.lastRenderTime=0,this.rendering=!1,this.smoothingFactor=s.clientSmoothingFactor,this.playerController=new o,this.foodController=new l,this.shootController=new h,s.debug&&(this.debug=new Debug),this.lagCompensation=s.serverLagCompensation}var s=i(0),a=i(1),r=i(41),o=(i(4),i(23)),l=i(22),h=i(24);t.exports=n,n.prototype={clearEntities:function(){console.log("removing"),this.playerController.clearEntities(),this.foodController.clearEntities(),this.shootController.clearEntities()},updatePlayerStates:function(){for(var t=this.playerController.getEntities(),e=t.length;e--;){var i=t[e];i.getUpdates().length&&this.updatePlayerState(i)}},updatePlayerState:function(t){var e=new Date,i=0;this.rendering&&(i=this.rendered+(e-this.lastRenderTime)),this.rendered=i,this.lastRenderTime=e;var n,s,a,o=this.getRenderTime(i),n=t.getInterpolatedUpdates(o);!n.previous&&t.isVisible()&&console.log("Jittering"),n.previous&&n.target?(s=this.getInterpolatedValue(n.previous.time,n.target.time,o),a=r.getInterpolatedEntityState(n.previous.state,n.target.state,s),t.setState(a),this.predictBallStates(t,o),this.rendering=!0):t.isToRemove()&&this.playerController.removeEntity(t)},getInterpolatedValue:function(t,e,i){var n=e-t,s=i-t,a=s/n;return a>1&&(a=1),parseFloat(a.toFixed(3))},getRenderTime:function(t){return this.serverTime-this.interpolationTime+t},setServerTime:function(t){this.serverTime=t},setElapsedLastUpdate:function(t){this.serverTime&&(this.elapsedLastUpdate+=t)},predictBallStates:function(t,e){var i=t.getBallController(),n=(e-i.getBallLastTime())/1e3;i.setBallLastTime(e);var s=i.getBallAngle(),a=r.getNewBallAngle(s,n);i.setBallAngle(a),r.checkNewBalls(t);for(var o=i.getEntities(),l=0;l<o.length;l++){var h=o[l],c=r.getNewBallState(t.state,h.state,a,l);h.setState(c)}},predictShootStates:function(t){for(var e=this.shootController.getEntities(),i=e.length;i--;){var n=e[i],s=r.getNewShootState(n,t);s?n.setState(s):this.shootController.removeEntity(n)}},predictFoodStates:function(t){for(var e=this.foodController.getEntities(),i=e.length;i--;){var n=e[i],s=r.getNewFoodState(n,t);s?n.setState(s):this.foodController.removeEntity(n)}},addPlayerUpdates:function(t,e){for(var i=e.length;i--;){var n,s=e[i],r=s[0],o=s[1],l=a.idxOf(this.playerController.getEntities(),"id",r);if(l>=0)n=this.playerController.getEntities()[l];else{var h=s[2],c=s[3];n=this.playerController.add(r,h,c,t)}n.addUpdate(o,t)}this.playerController.getEntities()},updateShootStates:function(t){for(var e=t.length;e--;){var i=t[e];this.shootController.add(i[0]).setState(i[1])}},updateFoodInitStates:function(t){for(var e=t.length;e--;){var i=t[e];this.foodController.add(i[0],i[2]).setState(i[1])}},updatePlayerRemoveStates:function(t){this.updateEntityRemoveStates(t,this.playerController)},updateFoodRemoveStates:function(t){this.updateEntityRemoveStates(t,this.foodController)},updateEntityRemoveStates:function(t,e){for(var i=this,n=t.length;n--;)!function(){var s=t[n];setTimeout(function(){var t=e.getEntities(),i=a.idxOf(t,"id",s);i>=0&&e.remove(i)},i.interpolationTime)}()},updateFoodEatStates:function(t){for(var e=this,i=t.length;i--;)!function(){var n=t[i][0],s=t[i][1];setTimeout(function(){var t=e.foodController.getEntities(),i=a.idxOf(t,"id",n);if(i>=0){var r=t[i],o=e.playerController.getEntities(),l=a.idxOf(o,"id",s);if(l>=0){var h=o[l];r.referrer=h}}},e.interpolationTime)}()},updateBoard:function(t){t.length&&(this.playerController.setBoard(t),this.playerController.setUpdatedBoard(!0))},getPlayerController:function(){return this.playerController},getFoodController:function(){return this.foodController},getShootController:function(){return this.shootController}}},function(t,e){function i(t){var e=document.getElementById("chat-text"),i=document.getElementById("chat-input"),n=document.getElementById("chat-form");t.on("addToChat",function(t){e.innerHTML+="<div>"+t+"</div>"}),t.on("evalAnswer",function(t){console.log(t)}),n.onsubmit=function(e){e.preventDefault(),"/"===i.value[0]?t.emit("evalServer",i.value.slice(1)):t.emit("sendMsgToServer",i.value),i.value=""}}t.exports=i},function(t,e){function i(){debugDiv.style.display="inline-block",this.serverPhysicsInterval=null,this.serverStateInterval=null,this.lagCompensation=null,this.interpolation=null,this.interpolationTime=null;var t=(document.getElementById("player_status"),document.getElementById("lag")),e=document.getElementById("serverPhysicsInterval"),i=document.getElementById("serverStateInterval"),n=document.getElementById("interpolation"),s=document.getElementById("interpolationTime");e.value=cfg.serverPhysicsInterval,i.value=cfg.serverStateInterval,t.value=cfg.serverLagCompensation,n.checked=cfg.interpolation,s.value=cfg.interpolationTime;var a=function(){this.lagCompensation=r(this.lagCompensation,t),this.serverPhysicsInterval=r(this.serverPhysicsInterval,e),this.serverStateInterval=r(this.serverStateInterval,i),this.interpolation=n.checked,this.interpolationTime=r(this.interpolationTime,s)}.bind(this),r=function(t,e){var i=parseInt(e.value);return isNaN(i)&&(i=t),e.value=i,i};t.onchange=a,e.onchange=a,i.onchange=a,n.onchange=a,s.onchange=a,a()}t.exports=i},function(t,e){function i(){}t.exports=i,i.prototype.form=function(){var t=new ArrayBuffer(1);return new DataView(t).setUint8(0,2),t}},function(t,e){function i(t){this.input=t}t.exports=i,i.prototype.form=function(){var t=new ArrayBuffer(1);return new DataView(t).setUint8(0,this.input),t}},function(t,e,i){function n(t){this.name=t}var s=i(38);t.exports=n,n.prototype.form=function(){var t=new s;return t.setUint8(1),t.setStringUTF8(this.name),t.form()}},function(t,e,i){t.exports={Submit:i(30),Clear:i(28),Input:i(29)}},function(t,e,i){function n(){this.seqUpdates=0,this.handler={1:this.onMsgSubmit.bind(this),2:this.onMsgClear.bind(this),10:this.onMsgUpdate.bind(this)},this.handleSocketEvents()}var s=i(37);i(0);t.exports=n,n.prototype={handleSocketEvents:function(){this.socket.onmessage=function(t){var e=t.data;this.handleMessage(e)}.bind(this),this.socket.onclose=function(){this.onDisconnect()}.bind(this),this.socket.onerror=function(t){console.log("ERROR "+t.data)}},handleMessage:function(t){if(0!==t.byteLength){var e=new DataView(t),i=e.getUint8(0);this.handler.hasOwnProperty(i)&&this.handler[i](t)}},onMsgClear:function(t){this.stateController.clearEntities(),-1!==this.selfId&&(this.selfId=-1,this.inTransition=!0)},onMsgSubmit:function(t){var e=new s(t);e.addOffset(1);var i=e.getUint16();console.log(i),this.selfId=i,this.inTransition=!0},onMsgUpdate:function(t){var e=new s(t);e.addOffset(1);var i=e.getUint32();this.stateController.rendering&&(this.stateController.rendered-=i-this.stateController.serverTime),this.stateController.setServerTime(i);var n=e.getFlags(),a=n[0],r=n[1],o=n[2],l=n[3],h=n[4],c=n[5],d=n[6];if(a){for(var u=e.getUint8(),p=[],f=0;f<u;f++){var v,g,m=e.getUint16(),y={},x=e.getFlags(),b=x[0],w=x[1],S=x[2],I=x[3],T=x[4],C=x[5];y.ring=x[6],y.dashing=x[7];var R=e.getFlags(),M=R[0];if(b&&(v=e.getStringUTF8()),w&&(y.x=e.getFloat32()),S&&(y.y=e.getFloat32()),I){var k=e.getInt16();y.vx=k/100}if(T){var L=e.getInt16();y.vy=L/100}C&&(y.mass=e.getUint32()),M&&(g=e.getFloat32(),console.log("angle "+g)),b?(console.log(m),p.push([m,y,v,g])):p.push([m,y])}this.stateController.addPlayerUpdates(i,p)}if(r){for(var F=e.getUint16(),E=[],f=0;f<F;f++){var m=e.getUint16();E.push(m)}this.stateController.updatePlayerRemoveStates(E)}if(o){for(var B=e.getUint8(),P=[],f=0;f<B;f++){var y={};y.x=e.getFloat32(),y.y=e.getFloat32(),y.mass=e.getUint16(),y.lifeTime=e.getUint16(),P.push([null,y])}this.stateController.updateShootStates(P)}if(l){for(var D=e.getUint16(),U=[],f=0;f<D;f++){var m=e.getUint16(),y={movingTime:0,angle:0,vr:Math.random()};y.xReal=e.getFloat32(),y.yReal=e.getFloat32(),y.x=y.xReal,y.y=y.yReal;var z=e.getUint8();U.push([m,y,z])}this.stateController.updateFoodInitStates(U)}if(h){for(var O=e.getUint16(),X=[],f=0;f<O;f++){var m=e.getUint16();X.push(m)}this.stateController.updateFoodRemoveStates(X)}if(c){for(var A=e.getUint8(),V=[],f=0;f<A;f++){var m=e.getUint16(),G=e.getUint16();V.push([m,G])}this.stateController.updateFoodEatStates(V)}if(d){for(var q=e.getUint8(),H=[],f=0;f<q;f++){var v=e.getStringUTF8();H.push(v)}this.stateController.updateBoard(H)}}}},function(t,e,i){function n(){this.onSubmit()}var s=i(31);t.exports=n,n.prototype={sendMessage:function(t){if(1===this.socket.readyState){var e=t.form();this.socket.send(e)}else this.onDisconnect()},onSubmit:function(){var t=document.getElementById("sign-form"),e=document.getElementById("signDiv-username");t.onsubmit=function(t){t.preventDefault(),this.sendMessage(new s.Submit(e.value))}.bind(this)},onSubmitted:function(){this.sendMessage(new s.SubmitACK)},onInput:function(t){this.sendMessage(new s.Input(t))}}},function(t,e){function i(){this.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),this.now=new Date,this.accum=0}t.exports=i,i.prototype.start=function(t,e){function i(){n.requestAnimFrame.call(window,i);var s=new Date,a=s-n.now;for(a>250&&(a=250),n.now=s,n.accum+=a;n.accum>=15;)t(),n.accum-=15;e()}var n=this;i()}},function(t,e){function i(){this.keyCodes={},this.keyUp={left:!0,up:!0,right:!0,down:!0,space:!0},this.alias={leftEU:65,leftUS:81,up:90,right:68,down:83,space:32,pageup:33,pagedown:34,tab:9},this.onKeyDown=function(t){this.onKeyChange(t,!0)}.bind(this),this.onKeyUp=function(t){this.onKeyChange(t,!1)}.bind(this),document.addEventListener("keydown",this.onKeyDown,!1),document.addEventListener("keyup",this.onKeyUp,!1),window.addEventListener("keydown",function(t){[32,37,38,39,40].indexOf(t.keyCode)>-1&&t.preventDefault()},!1)}t.exports=i,i.prototype={destroy:function(){document.removeEventListener("keydown",this.onKeyDown,!1),document.removeEventListener("keyup",this.onKeyUp,!1)},onKeyChange:function(t,e){var i=t.keyCode;this.keyCodes[i]=e},pressed:function(t){for(var e=t.split("+"),i=0;i<e.length;i++){var n,s,a=e[i];if(s=-1!=Object.keys(this.alias).indexOf(a)?this.alias[a]:a.toUpperCase().charCodeAt(0),n=this.keyCodes[s],!n)return!1}return!0}}},function(t,e){function i(t){this.canvas=t,this.running=!1,this.click=!1,this.angle=0,this.wheel=0,this.canvas.addEventListener("click",function(t){this.onClick(t)}.bind(this)),this.canvas.addEventListener("mousewheel",function(t){this.onMouseWheel(t)}.bind(this))}t.exports=i,i.prototype={onClick:function(t){if(this.running){t=t||window.event,this.click="click"==t.type;var e=t.pageX-this.canvas.offsetLeft,i=t.pageY-this.canvas.offsetTop,n=-this.canvas.clientWidth/2+e,s=-this.canvas.clientHeight/2+i;this.angle=Math.atan2(s,n)}},onMouseWheel:function(t,e){this.running&&(t.deltaY>0?this.wheel--:t.deltaY<0&&this.wheel++,t.preventDefault())},wheeled:function(){var t=this.wheel;return this.wheel=0,t}}},function(t,e){function i(t){this.buf=t,this.view=new DataView(this.buf),this.offset=0}t.exports=i,i.prototype={getUint8:function(){var t=this.view.getUint8(this.offset);return this.offset+=1,t},getInt8:function(){var t=this.view.getInt8(this.offset);return this.offset+=1,t},getUint16:function(){var t=this.view.getUint16(this.offset,!0);return this.offset+=2,t},getInt16:function(){var t=this.view.getInt16(this.offset,!0);return this.offset+=2,t},getUint32:function(){var t=this.view.getUint32(this.offset,!0);return this.offset+=4,t},getInt32:function(){var t=this.view.getInt32(this.offset,!0);return this.offset+=4,t},getFloat32:function(){var t=this.view.getFloat32(this.offset,!0);return this.offset+=4,t},getStringUTF8:function(){for(var t="",e=[],i=this.getUint8(),n=0;n<i;n++){var s=this.getUint8();e.push(s)}if(i)try{t=decodeURIComponent(escape(String.fromCharCode.apply(null,e)))}catch(t){}return t},getFlags:function(){var t=this.getUint8();return this.fromByte(t)},fromByte:function(t){for(var e=new Array(8),i=0;i<8;i++)e[i]=0!=(t&1<<i);return e},addOffset:function(t){this.offset+=t}}},function(t,e){function i(){this.bytes=[],this.miniBuf=new ArrayBuffer(4),this.miniView=new DataView(this.miniBuf)}t.exports=i,i.prototype={setUint8:function(t){this.miniView.setUint8(0,t),this.addToBytes(1)},setInt8:function(t){this.miniView.setInt8(0,t),this.addToBytes(1)},setUint16:function(t){this.miniView.setUint16(0,t,!0),this.addToBytes(2)},setInt16:function(t){this.miniView.setInt16(0,t,!0),this.addToBytes(2)},setUint32:function(t){this.miniView.setUint32(0,t,!0),this.addToBytes(4)},setInt32:function(t){this.miniView.setInt32(0,t,!0),this.addToBytes(4)},setFloat32:function(t){this.miniView.setFloat32(0,t,!0),this.addToBytes(4)},setStringUTF8:function(t){if(t&&t.length){var e=unescape(encodeURIComponent(t));this.setUint8(e.length);for(var i=0;i<e.length;i++)this.setUint8(e.charCodeAt(i))}else this.setUint8(0)},setFlags:function(t){var e=this.toByte(t);this.setUint8(e)},toByte:function(t){for(var e=0,i=0;i<t.length;i++)t[i]&&(e|=1<<i);return e},addToBytes:function(t){for(var e=0;e<t;e++)this.bytes.push(this.miniView.getUint8(e));this.clearMiniBuf()},clearMiniBuf:function(){this.miniBuf=new ArrayBuffer(4),this.miniView=new DataView(this.miniBuf)},form:function(){for(var t=new ArrayBuffer(this.bytes.length),e=new DataView(t),i=0;i<this.bytes.length;i++)e.setUint8(i,this.bytes[i]);return t}}},function(t,e,i){var n=i(40);n.env="development",t.exports=n},function(t,e,i){t.exports={env:"development",serverPort:i.i({NODE_ENV:"production"}).PORT||3e3,serverUrl:"flapzd.herokuapp.com",serverMaxGamers:10,serverMaxSameIp:5,serverLagCompensation:0,serverPacketMaxSize:128,tickMain:50,tickBoard:10,tickPhysics:17,tickState:50,tickScope:8,clientMaxUpdateBuffer:120,clientInterpolationTime:100,clientSmoothingFactor:.3,debug:!1,debugMove:!1,scopeRatio:16/9,scopeInitX:1280,scopeInitY:720,tileAmountX:100,tileAmountY:100,tileScopeAmountX:17,tileScopeAmountY:11,tileFoodRange:5,zoomFactor:1.1,zoomScaleLimit:2.5,debugZoom:!0,debugTileSize:!1,debugSelfScope:!1,debugBorder:!1,mapSize:23200,mapScale:.65,minimapRad:50,miniselfRad:3,midLimitRad:3e3,midLimitStroke:1600,midLimitOffset:1400,endLimitRad:1e4,endLimitStroke:1600,endLimitOffset:6e3,tunnelHeight:300,playerNameMaxSize:15,playerImmunityTime:1e4,playerVx:152,playerVy:240,playerGravity:660,playerMinMassDash:0,playerInitMass:0,scaleMassFactor:.005,selfRadiusInitSize:25,selfRadiusFactor:.16,playerSpriteInitSize:60,playerSpriteFactor:.8,debugSelfHitbox:!1,ballTreshold:500,ballSpeed:1.4,ballInitSize:20,ballFactor:.5,ballSpriteInitSize:100,ballSpriteFactor:2,debugBall:!1,dashSpeed:800,dashMassLoss:1,dashTime:500,dashTxtSize:4,shootInitSize:64,shootTime:1e3,ringInitSize:100,ringFactor:2,ringMaxInitSize:151,ringMaxFactor:4.1,ringFreqInit:2e3,ringFreqFactor:20,ringTime:300,debugRingHitbox:!1,foodSpawnAmount:500,foodInsideProportion:.5,foodMasses:[1,2,3,4],foodHitbox:20,foodInitSize:10,foodFactor:5.6,foodSpriteInitSize:6,foodSpriteFactor:15,foodEatenHitbox:8,foodMovingTime:1e3,foodRotationSpeed:.0035,foodRotationRadius:8,debugFood:!1,debugFoodHitbox:!1,gradColors:[12255092,6783231,12189695,16753707,12091391,16748688,16732754,16740840,16574822],playerSet:"/client/img/grumpy.json",fireballSet:"/client/img/fireball.json",ringImg:"/client/img/firewater.png",shootImg:"/client/img/bullet.png",foodImg:"/client/img/v10.png",mapImg:"/client/img/black.jpg",bgImg:"/client/img/wormax.png",spectatorInitState:{x:0,y:0,mass:0},textOpt:{fontFamily:"raleway",fill:"#ffffff",stroke:"#000000"}}},function(t,e,i){var n=i(0),s=i(5),a=i(1);e.getExtrapolatedPlayerState=function(t,e){var i={};return i.x=t.x,i.y=t.y,i.vx=t.vx,i.vy=t.vy,i.ring=t.ring,i.mass=t.mass,i.dashing=t.dashing,i.vy<n.playerVy&&(i.vy+=n.playerGravity*e),i.vy>n.playerVy&&(i.vy=n.playerVy),i.x+=i.vx*e,i.y+=i.vy*e,i};var r=function(t,e){var i=a.distEucl(0,0,t,e);return!!(i<=n.midLimitRad||i>=n.midLimitRad+n.midLimitStroke&&i<=n.endLimitRad||a.inRect(t,e,-(n.midLimitRad+n.midLimitStroke/2),0,n.midLimitStroke+100,n.tunnelHeight)||a.inRect(t,e,n.midLimitRad+n.midLimitStroke/2,0,n.midLimitStroke+100,n.tunnelHeight))};e.getNewPlayerState=function(t,e,i){var s=t.id,r=t.state,l=i.getPlayerController(),h=i.getShootController(),c={};c.x=r.x,c.y=r.y,c.ring=r.ring,c.mass=r.mass,c.dashing=r.dashing,c.immunity=r.immunity,c.startTime=r.startTime,c.vx=r.vx,c.vy=r.vy,c.lastFlap=r.lastFlap,c.lastRing=r.lastRing,c.lastDash=r.lastDash,c.canDash=r.canDash,c.dashX=r.dashX,c.dashY=r.dashY,c.dashRange=r.dashRange,c.dashDone=r.dashDone;var d=a.getSelfRadius(c.mass);if(o(t,c,i,h),p(c),c.immunity)return c;if(!f(c,e))return!1;var u=i.getTiles(c.x,c.y,n.tileFoodRange,n.tileFoodRange);return y(c,u,d,t),c.dashing?c:!x(c,i,l,d,s)&&c};var o=function(t,e,i,s){n.debugMove&&(e.vx=0),t.pressLeft&&!e.dashing?l(e):t.pressRight&&!e.dashing?h(e):t.pressDash&&e.mass>=n.playerMinMassDash?c(t,e,s):t.pressClick&&u(i)},l=function(t){t.vx=-n.playerVx,t.vy=-n.playerVy,t.lastFlap=new Date,t.immunity&&(t.immunity=!1),n.debugMove&&(t.vx=-150)},h=function(t){t.vx=n.playerVx,t.vy=-n.playerVy,t.lastFlap=new Date,t.immunity&&(t.immunity=!1),n.debugMove&&(t.vx=150)},c=function(t,e,i){e.dashing=!0,e.lastDash=new Date,e.lastRing=new Date,e.canDash=!1,e.ring=!1,e.mass=Math.round(e.mass*n.dashMassLoss),d(t,e,i)},d=function(t,e,i){i.add(t),e.dashX=e.x,e.dashY=e.y,e.dashRange=a.getRingMax(e.mass),e.dashDone=0},u=function(t){for(var e=0;e<n.foodSpawnAmount;e++){var i=s.getInitFoodState(),r=t.getTile(i.x,i.y),o=a.randomIntFromInterval(0,n.foodMasses.length-1),l=n.foodMasses[o];r.getFoodController().add(l).setState(i)}},p=function(t){t.immunity&&new Date-t.startTime>n.playerImmunityTime&&(t.immunity=!1,t.vx=n.playerVx,t.vy=n.playerVy)},f=function(t,e){var i,n=Math.atan2(t.vy,t.vx);return t.dashing||(i=v(t,e)),t.dashing&&t.dashDone<t.dashRange&&(i=g(t,e,n)),t.dashing&&t.dashDone>=t.dashRange&&(i=m(t,n)),!!r(i.x,i.y)&&(t.x=i.x,t.y=i.y,!0)},v=function(t,e){return t.vy<n.playerVy&&new Date-t.lastFlap>100&&(t.vy+=n.playerGravity*e),t.vy>n.playerVy&&(t.vy=n.playerVy),n.debugMove&&(t.vy=0),{x:t.x+t.vx*e,y:t.y+t.vy*e}},g=function(t,e,i){return t.dashDone+=n.dashSpeed*e,{x:t.x+n.dashSpeed*Math.cos(i)*e,y:t.y+n.dashSpeed*Math.sin(i)*e}},m=function(t,e){return t.dashing=!1,{x:t.dashX+t.dashRange*Math.cos(e),y:t.dashY+t.dashRange*Math.sin(e)}},y=function(t,e,i,n){for(var s=e.length;s--;)for(var r=e[s],o=r.getFoodController(),l=o.getEntities(),h=l.length;h--;){var c=l[h],d=a.distEucl(c.state.x,c.state.y,t.x,t.y),u=a.getFoodRadius(c.mass);d<i+u&&(t.mass+=c.mass,o.remove(c,n.id))}},x=function(t,e,i,n,s){for(var a=i.getEntities(),r=a.length;r--;){var o=a[r];if(-1!==a[r].id&&o.id!=s)for(var l=o.getBallController().getEntities(),h=0;h<l.length;h++){var c=l[h];if(b(t,e,n,c))return!0}}},b=function(t,e,i,n){var s=a.distEucl(n.state.x,n.state.y,t.x,t.y);if(i+a.getBallRadius(n.state.mass)>s){for(var r=0;r<20;r++);return!0}};e.getNewBallAngle=function(t,e){return(t+n.ballSpeed*e)%(2*Math.PI)},e.checkNewBalls=function(t){var e=t.getBallController(),i=e.getEntities(),s=t.state,a=s.mass;i.length||e.add(s),a>=n.ballTreshold&&1===i.length&&e.add(s),a>=2*n.ballTreshold&&2===i.length&&e.add(s)},e.getNewBallState=function(t,e,i,n){var a=(i+2*n*Math.PI/3)%(2*Math.PI),r=w(t.mass,n),o=s.getInitBallState(t,r,a);return o.active=e.active,o};var w=function(t,e){var i,s=n.ballTreshold,a=t-s,r=t-2*s,o=t-3*s,l=s+Math.round(o/3);return 0===e?i=t<s?t:t>=s&&t<3*s?s:l:1===e?i=t>=s&&t<2*s?a:t>=2*s&&t<3*s?s:l:2===e&&(i=t>=2*s&&t<3*s?r:l),i};e.getNewShootState=function(t,e){var i={},s=t.state;return i.x=s.x,i.y=s.y,i.mass=s.mass,i.lifeTime=s.lifeTime+e,i.ring=s.ring,!i.ring&&i.lifeTime>n.dashTime&&(i.ring=!0),!(i.lifeTime>n.dashTime+n.shootTime)&&i},e.getNewFoodState=function(t,e){var i={},s=t.state;if(i.xReal=s.xReal,i.yReal=s.yReal,i.angle=s.angle,i.vr=s.vr,i.movingTime=s.movingTime,void 0===t.referrer)i.angle=(s.angle+i.vr*n.foodRotationSpeed*e)%(2*Math.PI),i.x=s.xReal+n.foodRotationRadius*Math.cos(s.angle),i.y=s.yReal+n.foodRotationRadius*Math.sin(s.angle);else{var r=t.referrer.state;i.movingTime=s.movingTime+e;var o=r.x-s.x,l=r.y-s.y;if(i.x=s.x+o*i.movingTime/n.foodMovingTime,i.y=s.y+l*i.movingTime/n.foodMovingTime,a.distEucl(i.x,i.y,r.x,r.y)<n.foodEatenHitbox)return!1}return i},e.getInterpolatedEntityState=function(t,e,i){var n={};return n.x=t.x+i*(e.x-t.x),n.y=t.y+i*(e.y-t.y),n.vx=e.vx,e.vx/t.vx<0?n.vy=e.vy:n.vy=t.vy+i*(e.vy-t.vy),n.mass=Math.round(t.mass+i*(e.mass-t.mass)),n.ring=e.ring,n.dashing=e.dashing,n}},function(t,e){function i(){this.filterStrength=20,this.frameTime=0,this.lastLoop=new Date,this.thisLoop=null,this.value=0,this.oldValue=0}t.exports=i,i.prototype.setFps=function(t){var e=(this.thisLoop=t)-this.lastLoop;this.frameTime+=(e-this.frameTime)/this.filterStrength,this.lastLoop=this.thisLoop},i.prototype.getFps=function(){return(1e3/this.frameTime).toFixed(1)},i.prototype.startServer=function(){setInterval(function(){this.value=Math.ceil(1e3/this.frameTime),this.value!=this.oldValue&&(console.log(this.value+" FPS"),this.oldValue=this.value)}.bind(this),1e3)}},function(t,e,i){t.exports=i(6)}]);